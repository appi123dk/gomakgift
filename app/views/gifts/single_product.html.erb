<!-- BANNER -->
<div id="banner" style="margin-top:50px;">
    <div id="wrapper" style="width:100%; overflow:hidden;">
        <div id="container" style="width:100%; margin-right:auto;">
                <img style="width: 100%; background-position: center center; background-repeat: no-repeat; background-size: cover" src="<%= @product.product_banner_image %>" alt="<%= @product.title %>_image"/>
        </div>
    </div>
</div>

<!-- MAIN CONTENT SECTION -->
<section class="mainContent clearfix" style="padding-top: 20px">
<div class="container">
  <div class="row singleProduct">
    <div class="col-xs-12">
      <div class="media">
        <div class="media-left productSlider">
          <div id="carousel" class="carousel slide" data-ride="carousel" style="margin-top: 60px;">
            <div class="carousel-inner">
              <% data_num = 0 %>
              <% @product.thumbnails.each do |thumbnail| %>
                <div class="item" data-thumb="<%=raw data_num %>">
                 <img src="<%= thumbnail.img_url %>" alt="" width="100%">
                </div>
                <% data_num += 1 %>
              <% end %>
            </div>
          </div> 
          <div class="clearfix">
            <div id="thumbcarousel" class="carousel slide" data-interval="false">
              <div class="carousel-inner">
                <% data_small_num = 0 %>
                <% @product.thumbnails.each do |thumbnail| %>
                  <div data-target="#carousel" data-slide-to="<%=raw data_small_num %>" class="thumb"><img src="<%= thumbnail.img_url %>"></div>
                  <% data_small_num += 1 %>
                <% end %>
              </div>
              <a class="left carousel-control" href="#thumbcarousel" role="button" data-slide="prev">
                <span class="glyphicon glyphicon-chevron-left"></span>
              </a>
              <a class="right carousel-control" href="#thumbcarousel" role="button" data-slide="next">
                <span class="glyphicon glyphicon-chevron-right"></span>
              </a>
            </div>
          </div>
        </div>
        <div class="media-body">
          <ul class="list-inline">
            <div class="single-product-descript">
              <div class="single-product-header">
                <h3><%= @product.title %></h3>
                <p><%= @product.subtitle %></p>
              </div>
              <hr> 
              <div class="row">
                <div class="col-xs-4">
                  <h6 style="margin-bottom: 26px; margin-top: 5px">추천행사</h6>
                  <h6 style="margin-bottom: 26px; margin-top: 5px">패키지여부</h6>
                </div>
                <div class="col-xs-offset-1 col-xs-7">
                  <p class="product-info" style="margin-bottom: 15px;"><%= @product.recommend_festival %></p>
                  <p class="product-info" style="margin-bottom: 15px;"><%= @product.explain_package %></p>
                </div>
              </div>
              <div class="row">
                <div class="col-xs-4">
                  <h6 style="margin-bottom: 10px; margin-top: 0px">상품스토리</h6>
                </div>
                <div class="col-xs-12" style="padding-left: 15px;">
                  <p class="product-info" style="margin-bottom: 15px;"><%= @product.mainpage_story %></p>
                </div>
              </div>
              <hr>
              <div class="price-table">
                <h5>가격표</h5>
                <table class="table table-hover product-table" style="width:100%; margin-bottom: 5px;">
                  <thead>
                    <tr>
                        <th style="border-top: 1px solid black">수량</th>
                        <th class="qty" style="border-top: 1px solid black"><%= number_with_delimiter(@product_qty.qty_max, delimiter: ',') %></th>
                        <th class="qty" style="border-top: 1px solid black"><%= number_with_delimiter(@product_qty.qty_1, delimiter: ',') %></th>
                        <th class="qty" style="border-top: 1px solid black"><%= number_with_delimiter(@product_qty.qty_2, delimiter: ',') %></th>
                        <th class="qty" style="border-top: 1px solid black"><%= number_with_delimiter(@product_qty.qty_3, delimiter: ',') %></th>
                        <th class="qty" style="border-top: 1px solid black"><%= number_with_delimiter(@product_qty.qty_4, delimiter: ',') %></th>
                        <th class="qty" style="border-top: 1px solid black"><%= number_with_delimiter(@product_qty.qty_5, delimiter: ',') %></th>
                        <th class="qty" style="border-top: 1px solid black"><%= number_with_delimiter(@product_qty.qty_6, delimiter: ',') %></th>
                        <!-- <th style="border-top: 1px solid black">300</th> -->
                    </tr>
                  </thead>
                  <tbody>
                    <tr class="question">
                        <td><%= @product_price.price_name %></td>
                        <td class="price"><%= number_with_delimiter(@product_price.price_min, delimiter: ',') %></td>
                        <td class="price"><%= number_with_delimiter(@product_price.price_1, delimiter: ',') %></td>
                        <td class="price"><%= number_with_delimiter(@product_price.price_2, delimiter: ',') %></td>
                        <td class="price"><%= number_with_delimiter(@product_price.price_3, delimiter: ',') %></td>
                        <td class="price"><%= number_with_delimiter(@product_price.price_4, delimiter: ',') %></td>
                        <td class="price"><%= number_with_delimiter(@product_price.price_5, delimiter: ',') %></td>
                        <td class="price"><%= number_with_delimiter(@product_price.price_6, delimiter: ',') %></td>
                    </tr>
                  </tbody>
                </table>
                <p style="display: inline-block; margin-bottom: 0px; font-size:10px">* 수량과 가격은 흥정 가능합니다 / <span style="font-weight: bold">문의전화 1522 - 9406</span> * </p>
              </div>
              <hr>
              <div class="order-form">
                <form action="/orders/new_cart" method="GET" id="order_form">
                  <ul class="list-unstyled" style="line-height: 200%">
                    <li>주문수량 X 단가 : 
                      <input type="number" placeholder="갯수를 입력하세요" style="text-align: right" id="input_price" class="input_price" name="input_price" >
                      X <span id="target_price">0</span> = <span id="sub_price">0</span> 원
                    </li>
                    <li>부가세 (VAT) : <span id="vat">0</span> 원</li>
                    <li style="font-weight: bold; ">합계금액 : <span id="total_price">0</span> 원</li>
                    <input type="hidden" name="total_price" id="input_total_price" >
                    <input type="hidden" name="product_id" value="<%= @product.id %>" >
                    <input type="hidden" name="product_id" value="<%= @product.id %>" >
                  </ul>
<!--                   <hr>
                  <ul class="list-unstyled" style="line-height: 200%">
                    <li>인쇄방법 : 
                      <select name="option1" required>
                        <option value="" disabled selected>인쇄방법을 선택해주세요</option>
                        <option value="레이저인쇄">레이저인쇄</option>
                        <option value="땡땡인쇄">땡땡인쇄</option>
                      </select>
                    </li>
                    <li>인쇄위치 : 
                      <select name="option2" required>
                        <option value="" disabled selected>인쇄위치를 선택해주세요</option>
                        <option value="1">Section 1</option>
                        <option value="2">Section 2</option>
                      </select>
                    </li>
                  </ul> -->
                  <button class="btn btn-submit btn-product"><i class="fa fa-shopping-cart" style="font-size:18px"></i> <span style="margin-left: 15px;">장바구니담기</span></button>
                </form>
              </div>
            </div>
          </ul>
        </div>
      </div>
    </div>
  </div>
  <hr>  
  <!-- 추천상품영역 -->
  <% unless @recommend_products.nil? %>
  <div class="row productsContent">
    <div class="col-xs-12">
      <div class="page-header">
        <h5>관련 추천상품 보기</h5>
      </div>
    </div>
    <% @recommend_products.each do |recommend_product| %>
    <div class="col-md-2 col-sm-3 col-xs-3">
      <div class="productBox">
        <div class="productImage clearfix" style="margin-bottom: 0px">
          <img src="<%= recommend_product.thumbnails.first.img_url %>" alt="products-img">
        </div>
        <div class="productCaption clearfix">
         <p><%= recommend_product.title %></p>
         <h5><%= recommend_product.price.price_min %>원</h5>
        </div>
      </div>
    </div>
    <% end %>
  </div>
  <% end %>
  <!-- 끝 -->
</div>
<div class="container-custom">
  <!-- FEATURE COLLECTION SECTION -->
  <div class="row featuredCollection version2" style="margin-top: 40px; margin-bottom: 20px;">
    <div class="col-sm-12 col-lg-offset-2 col-lg-8" style="padding-left: 0px; padding-right: 0px;">
      <img src="<%= @product.product_image %>" class="img-responsive" style="width:100%">      
      <hr>
    </div>
  </div>
  <div class="row featuredCollection version2">
    <div class="col-sm-12 col-lg-offset-2 col-lg-8 information-box">
      <h5><i class="fa fa-info-circle"></i> 제품정보고시</h5>
      <hr style="margin: 10px 0 10px 0;">
      <ol>
        <%=raw @product.detail %>
      </ol>
    </div>
  </div>
  <div class="row featuredCollection version2">
    <div class="col-sm-12 col-lg-offset-2 col-lg-8 information-box">
      <h5> <i class="fa fa-angle-right"></i> 배송정보</h5>
      <hr style="margin: 10px 0 10px 0;">
      <ol>
        <li>배송은 국내택배배송을 원칙으로하며, 배송비는 무료입니다.</li>  
        <li>
          배송기간 : 제작일로부터 3 ~ 7일 (토요일 및 공휴일 제외)<br/>
            - 구매자가 원하실 경우 화물, 퀵서비스 등을 이용하여 배송이 가능합니다.
        </li>
        <li>도서산간지방, 항공, 우편, 퀵배송등 배송시 추가비용은 구매자 부담입니다.</li>
      </ol>
    </div>
  </div>
  <div class="row featuredCollection version2">
    <div class="col-sm-12 col-lg-offset-2 col-lg-8 information-box">
      <h5> <i class="fa fa-angle-right"></i> 교환 / 반품 / AS안내</h5>
      <hr style="margin: 10px 0 10px 0;">
      <ol>
        <li>상품 수령일로부터 7일 이내 교환 및 반품신청이 가능합니다.</li>
        <li>제품 또는 인쇄 불량의 경우 교환 또는 전액 환불해드립니다.</li> 
        <li>주문제작형 상품, 인쇄 상품 등 재사용이 어려운 제품은 단순 변심에 의해 교환 및 반품이 불가합니다.</li>
        <li>고객의 부주의로 인해 상품이 훼손되거나 하자가 발생한 경우, 교환 및 반품이 불가합니다.</li> 
        <li>교환 및 반품 : 고객센터 1522 - 9406 전화접수를 통해 진행합니다.</li>  
      </ol>
    </div>
  </div>
  <div class="row featuredCollection version2">
    <div class="col-sm-12 col-lg-offset-2 col-lg-8 information-box">
      <h5> <i class="fa fa-angle-right"></i> 기타유의사항</h5>
      <hr style="margin: 10px 0 10px 0;">
      <ol>
        <li>모니터 특성에 따라 실제 색상과 차이가 있을 수 있습니다.</li>
        <li>고객에게 최종 확인받은 시안에 대한 모든 책임은 고객에게 있습니다. 인쇄문구, 오타 등 철저하게 검토 후 최종 확인해주시기 바랍니다.</li>   
        <li>인쇄방법(붙박인쇄, 실크인쇄 등)의 차이로 인해 교정본과 다소 다른 인쇄결과가 나올 수 있습니다.</li>
        <li>모든 제품의 부가가치세는 별도가격이므로, 결제시 부가가치세(10%)를 합산하여 결제하셔야 합니다.</li>   
        <li>
          제품은 결제 후 제작을 원칙으로 합니다.<br/>
            - 대기업 또는 관공서 등의 결제는 담당자와 협의 후 진행바랍니다.
        </li>   
      </ol>
    </div>
  </div>
</div>

</section>
<!-- 위로가기버튼 -->
<a id="toTop" href="#"><img src="<%= image_path('bigbag/arrows/btop.png') %>" width="55" height="55" alt="맨 위로"></a>

<% content_for :javascript do %>
<script type="text/javascript" src="<%= asset_path('bigbag/plugins/jquery-number/jquery.number.min.js') %>"></script>

<script type="text/javascript">


$(function() {

  // 주문서 작성 계산기
  var qty_arr = <%= @qty_arr %>,
      price_arr = <%= @price_arr %>,
      qty_min = <%= @product_price.price_min %>;

  // Hide #MagicMenu on on scroll down
  var didScroll;
  var lastScrollTop = 0;
  var delta = 5;
  var navbarHeight = $('.navbar').outerHeight();


  $(window).scroll(function(event){
      didScroll = true;
  });

  // $("#product_information").hide();

  setInterval(function() {
      if (didScroll) {
          hasScrolled();
          didScroll = false;
      }
  }, 250);

  function hasScrolled() {
      var st = $(this).scrollTop();
      
      // Make sure they scroll more than delta
      if(Math.abs(lastScrollTop - st) <= delta)
          return;
      
      // If they scrolled down and are past the navbar, add class .navbar-up.
      // This is necessary so you never see what is "behind" the navbar.
      if (st > lastScrollTop && st > navbarHeight){
          // Scroll Down
          $('.navbar').fadeOut(100);
      } else {
          // Scroll Up
          if(st + $(window).height() < $(document).height()) {
              $('.navbar').fadeIn(100);
          }
      }
      
      lastScrollTop = st;
  }

  function find_price(qty){
    var price_idx;
    $.each(qty_arr, function(index, value){
      qty = parseInt(qty);
      if (qty >= value) {
        price_idx = index;
        return false;
      }
    });
    return price_idx;
  }

  $( window ).scroll( function() {
    if ( $( this ).scrollTop() > 1000 ) {
      $( '#toTop' ).fadeIn();
    } else {
      $( '#toTop' ).fadeOut();
    }
  } );

  $( '#toTop' ).click( function() {
    $( 'html, body' ).animate( { scrollTop : $('.mainContent').offset().top - 60 }, 400 );
    return false;
  } );

  // 상품의 가격, 상세정보를 볼 수 있도록 하는 화면 
  $('.show-product').click(function(){
    if ( $( "#product_information" ).is( ":hidden" ) ) {
      $( "#product_information" ).slideDown( "slow" );
    } else {
      $( "#product_information" ).slideUp();
    }
  });

  // 최소주문량만 주문 가능하도록 하는 기능
  // var qty_arr = [],
  //     qty_min = 0;
  // $('.qty').each(function(){
  //   qty_arr.push($(this).text());
  // });
  // qty_min = Math.min(... qty_arr);
  // $('.input_price').val(qty_min);


  $('.input_price').keyup( function(){
    var qty = parseInt($(this).val()),
        price_idx = find_price(qty),
        target_price = price_arr[price_idx],
        sub_price = qty * target_price;
        vat = sub_price/10,
        total_price = sub_price + vat;

        $('#target_price').text($.number(target_price));
        $('#sub_price').text($.number(sub_price));
        $('#vat').text($.number(vat));
        $('#total_price').text($.number(total_price));
        $('#input_total_price').val(total_price);
  });

   $("#order_form").validate({
        rules: {
            input_price: {
                required: true,
                min: qty_min
            },
        },
        messages: {
            input_price: {
                required: " | 갯수를 입력해주세요",
                min: " | 최소수량 이하는 주문할 수 없습니다"
            }
        },
        errorPlacement: function(error, element) {
          error.appendTo( element.parent() );
        }
    });

  $(".item").first().addClass('active');

});

</script>

<% end %>

